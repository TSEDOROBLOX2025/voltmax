<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLTMAX ‚Ä¢ Hub Corporativo de Energia</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #0062ff;
            --primary-hover: #0051d4;
            --bg: #f8fafc;
            --sidebar: #0f172a;
            --card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text-main); overflow-x: hidden; }
        .hidden { display: none !important; }

        /* --- AUTH MODAL --- */
        #auth-overlay {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9);
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .auth-card {
            background: var(--card); padding: 40px; border-radius: var(--radius);
            width: 100%; max-width: 400px; box-shadow: var(--shadow);
            animation: modalFade 0.3s ease;
        }
        @keyframes modalFade { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- LAYOUT --- */
        .layout { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
        .sidebar { background: var(--sidebar); color: white; padding: 30px 20px; display: flex; flex-direction: column; position: sticky; top: 0; height: 100vh; }
        .logo { font-size: 22px; font-weight: 800; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--primary); }
        
        .nav-link {
            padding: 12px 15px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; transition: 0.2s; color: #94a3b8; margin-bottom: 8px;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.1); color: white; }
        .nav-link.active { background: var(--primary); }

        /* --- CONTENT --- */
        main { padding: 40px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; }
        
        /* --- COMPONENTS --- */
        .card { background: var(--card); padding: 24px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #e2e8f0; }
        .stat-val { font-size: 32px; font-weight: 700; margin: 10px 0; color: var(--primary); }
        
        .btn {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;
            font-weight: 600; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
        
        input, select, textarea {
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; margin-top: 6px; margin-bottom: 16px;
        }

        .badge { padding: 4px 12px; border-radius: 99px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .badge-admin { background: #fee2e2; color: #ef4444; }
        .badge-func { background: #dbeafe; color: #3b82f6; }
        .badge-cid { background: #f1f5f9; color: #64748b; }

        /* --- TABLES --- */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; color: var(--text-muted); font-size: 13px; border-bottom: 2px solid #f1f5f9; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }

        /* --- TOAST --- */
        .toast {
            position: fixed; bottom: 20px; right: 20px; background: var(--sidebar); color: white;
            padding: 16px 24px; border-radius: var(--radius); box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 10000; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        @media (max-width: 768px) {
            .layout { grid-template-columns: 1fr; }
            .sidebar { display: none; }
        }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-card" id="login-form">
            <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                <i class="fas fa-bolt"></i> VOLT<span>MAX</span>
            </div>
            <h2 style="text-align: center; margin-bottom: 20px;">Bem-vindo</h2>
            <label>Email Corporativo</label>
            <input type="email" id="email-in" placeholder="usuario@voltmax.com">
            <label>Senha</label>
            <input type="password" id="pass-in" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button class="btn btn-primary" style="width: 100%" onclick="Auth.login()">Entrar no Sistema</button>
            <p style="text-align: center; margin-top: 20px; font-size: 14px;">
                N√£o possui conta? <a href="#" onclick="UI.toggleAuth(false)" style="color: var(--primary)">Solicitar Acesso</a>
            </p>
        </div>

        <div class="auth-card hidden" id="reg-form">
            <h2>Criar Conta</h2>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">A senha padr√£o para novos usu√°rios √© <b>acessluk</b>.</p>
            <label>Nome Completo</label>
            <input type="text" id="reg-name" placeholder="Nome">
            <label>E-mail</label>
            <input type="email" id="reg-email" placeholder="email@exemplo.com">
            <button class="btn btn-primary" style="width: 100%" onclick="Auth.register()">Registrar</button>
            <p style="text-align: center; margin-top: 20px; font-size: 14px;">
                J√° tem conta? <a href="#" onclick="UI.toggleAuth(true)" style="color: var(--primary)">Voltar ao Login</a>
            </p>
        </div>
    </div>

    <div class="layout hidden" id="app-layout">
        <aside class="sidebar">
            <div class="logo"><i class="fas fa-bolt"></i> VOLT<span>MAX</span></div>
            
            <div class="nav-link active" onclick="UI.showTab('dash', this)"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-link" onclick="UI.showTab('notices', this)"><i class="fas fa-bullhorn"></i> Comunicados</div>
            <div class="nav-link" onclick="UI.showTab('os', this)"><i class="fas fa-file-invoice"></i> Ordens de Servi√ßo</div>
            <div class="nav-link" id="nav-point" onclick="UI.showTab('point', this)"><i class="fas fa-clock"></i> Registrar Ponto</div>
            <div class="nav-link hidden" id="nav-admin" onclick="UI.showTab('admin', this)"><i class="fas fa-user-shield"></i> Administra√ß√£o</div>
            
            <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <div id="user-display" style="font-size: 13px; margin-bottom: 15px;"></div>
                <div class="nav-link" onclick="Auth.logout()" style="color: var(--danger);"><i class="fas fa-power-off"></i> Sair</div>
            </div>
        </aside>

        <main>
            <section id="tab-dash" class="tab-content">
                <div class="header-top">
                    <h1>Dashboard</h1>
                    <div id="real-time-clock" style="font-weight: 600; color: var(--text-muted);"></div>
                </div>
                <div class="grid">
                    <div class="card">
                        <h3>Consumo M√©dio</h3>
                        <div class="stat-val">48.2 <span style="font-size: 16px; color: var(--text-muted);">kW/h</span></div>
                        <p style="font-size: 12px; color: var(--success);"><i class="fas fa-arrow-down"></i> 4% em rela√ß√£o ao m√™s anterior</p>
                    </div>
                    <div class="card">
                        <h3>Economia Verde</h3>
                        <div class="stat-val" style="color: var(--success);">14.5%</div>
                        <p style="font-size: 12px; color: var(--text-muted);">Redu√ß√£o de CO2 este ano</p>
                    </div>
                    <div class="card">
                        <h3>O.S. Abertas</h3>
                        <div class="stat-val" id="os-count">0</div>
                        <p style="font-size: 12px; color: var(--warning);">Aguardando triagem t√©cnica</p>
                    </div>
                </div>
                <div class="card" style="margin-top: 24px;">
                    <h3>Carga da Rede em Tempo Real (MW)</h3>
                    <canvas id="consumptionChart" height="100"></canvas>
                </div>
            </section>

            <section id="tab-notices" class="tab-content hidden">
                <div class="header-top">
                    <h1>Comunicados</h1>
                    <button class="btn btn-primary hidden" id="btn-new-notice" onclick="UI.modal('modal-notice')"><i class="fas fa-plus"></i> Novo Aviso</button>
                </div>
                <div id="notices-container" class="grid"></div>
            </section>

            <section id="tab-os" class="tab-content hidden">
                <div class="header-top">
                    <h1>Ordens de Servi√ßo</h1>
                    <button class="btn btn-primary" onclick="UI.modal('modal-os')"><i class="fas fa-file-medical"></i> Abrir Chamado</button>
                </div>
                <div class="card">
                    <table id="os-table">
                        <thead>
                            <tr><th>Protocolo</th><th>Tipo</th><th>Endere√ßo</th><th>Solicitante</th><th>Status</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="tab-point" class="tab-content hidden">
                <h1>Registro de Jornada</h1><br>
                <div class="card" style="max-width: 500px; text-align: center;">
                    <i class="fas fa-clock" style="font-size: 48px; color: var(--primary); margin-bottom: 20px;"></i>
                    <h2 id="point-clock" style="font-size: 32px; margin-bottom: 10px;">00:00:00</h2>
                    <p style="color: var(--text-muted); margin-bottom: 24px;">Certifique-se de estar no local de trabalho.</p>
                    <button class="btn btn-primary" onclick="App.registerPoint()">Registrar Entrada/Sa√≠da</button>
                    <div id="last-points" style="margin-top: 30px; text-align: left;"></div>
                </div>
            </section>

            <section id="tab-admin" class="tab-content hidden">
                <h1>Painel Administrativo</h1><br>
                <div class="card">
                    <h3>Gest√£o de Usu√°rios</h3>
                    <table id="users-table">
                        <thead>
                            <tr><th>Nome</th><th>E-mail</th><th>Cargo</th><th>A√ß√µes</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div id="modal-notice" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:10000; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width: 500px;">
            <h3>Publicar Comunicado</h3><br>
            <label>T√≠tulo</label><input type="text" id="n-title">
            <label>Conte√∫do</label><textarea id="n-desc" rows="4"></textarea>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn btn-primary" onclick="App.publishNotice()">Publicar</button>
                <button class="btn" onclick="UI.modal('modal-notice')">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-os" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:10000; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width: 500px;">
            <h3>Abrir Chamado T√©cnico</h3><br>
            <label>Tipo de Ocorr√™ncia</label>
            <select id="os-type">
                <option>Queda de Energia</option>
                <option>Poste com Defeito</option>
                <option>Fios Ca√≠dos</option>
                <option>Nova Liga√ß√£o</option>
            </select>
            <label>Endere√ßo Completo</label>
            <input type="text" id="os-address" placeholder="Rua, N√∫mero, Bairro">
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn btn-primary" onclick="App.createOS()">Solicitar Reparo</button>
                <button class="btn" onclick="UI.modal('modal-os')">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyAs-Exemplo-Chave-Real",
            authDomain: "voltmax-empresa.firebaseapp.com",
            databaseURL: "https://voltmax-empresa-default-rtdb.firebaseio.com/",
            projectId: "voltmax-empresa",
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // --- M√ìDULO DE AUTENTICA√á√ÉO ---
        const Auth = {
            login() {
                const email = document.getElementById('email-in').value;
                const pass = document.getElementById('pass-in').value;
                auth.signInWithEmailAndPassword(email, pass).catch(err => UI.toast("Erro: " + err.message));
            },
            register() {
                const email = document.getElementById('reg-email').value;
                const name = document.getElementById('reg-name').value;
                auth.createUserWithEmailAndPassword(email, "acessluk").then(res => {
                    db.ref('users/' + res.user.uid).set({
                        nome: name,
                        email: email,
                        role: 'CIDADAO'
                    });
                    UI.toast("Conta criada com sucesso!");
                    UI.toggleAuth(true);
                }).catch(err => UI.toast(err.message));
            },
            logout() { auth.signOut(); location.reload(); }
        };

        // --- M√ìDULO DE INTERFACE ---
        const UI = {
            toast(msg) {
                const div = document.createElement('div');
                div.className = 'toast';
                div.innerHTML = `<i class="fas fa-info-circle"></i> ${msg}`;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 3000);
            },
            toggleAuth(showLogin) {
                document.getElementById('login-form').classList.toggle('hidden', !showLogin);
                document.getElementById('reg-form').classList.toggle('hidden', showLogin);
            },
            modal(id) { document.getElementById(id).classList.toggle('hidden'); },
            showTab(id, el) {
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.getElementById('tab-' + id).classList.remove('hidden');
                el.classList.add('active');
            }
        };

        // --- M√ìDULO PRINCIPAL ---
        const App = {
            currentUser: null,
            chart: null,

            init() {
                this.handleAuth();
                this.updateClock();
                this.initChart();
            },

            handleAuth() {
                auth.onAuthStateChanged(user => {
                    if (user) {
                        db.ref('users/' + user.uid).on('value', snap => {
                            this.currentUser = { uid: user.uid, ...snap.val() };
                            this.renderByRole();
                            document.getElementById('auth-overlay').classList.add('hidden');
                            document.getElementById('app-layout').classList.remove('hidden');
                            document.getElementById('user-display').innerHTML = `<b>${this.currentUser.nome}</b><br>${this.currentUser.email}`;
                        });
                        this.loadData();
                    } else {
                        document.getElementById('auth-overlay').classList.remove('hidden');
                        document.getElementById('app-layout').classList.add('hidden');
                    }
                });
            },

            renderByRole() {
                const role = this.currentUser.role;
                document.getElementById('nav-admin').classList.toggle('hidden', role !== 'ADMIN');
                document.getElementById('btn-new-notice').classList.toggle('hidden', role !== 'ADMIN');
                document.getElementById('nav-point').classList.toggle('hidden', role === 'CIDADAO');
                
                if (role === 'ADMIN') this.loadAdminData();
            },

            loadData() {
                // Not√≠cias em Tempo Real
                db.ref('notices').on('value', snap => {
                    const container = document.getElementById('notices-container');
                    container.innerHTML = '';
                    snap.forEach(child => {
                        const n = child.val();
                        container.innerHTML += `
                            <div class="card">
                                <span class="badge badge-cid">${n.date}</span>
                                <h3 style="margin-top:10px">${n.title}</h3>
                                <p style="font-size:14px; color:var(--text-muted); margin:10px 0">${n.desc}</p>
                                <small>Por: <b>${n.author}</b></small>
                            </div>`;
                    });
                });

                // OS em Tempo Real
                db.ref('os').on('value', snap => {
                    const tbody = document.getElementById('os-table').querySelector('tbody');
                    const osCount = document.getElementById('os-count');
                    tbody.innerHTML = '';
                    let count = 0;
                    snap.forEach(child => {
                        const o = child.val();
                        if(o.status === 'PENDENTE') count++;
                        tbody.innerHTML += `
                            <tr>
                                <td>#${child.key.slice(-5)}</td>
                                <td><b>${o.type}</b></td>
                                <td>${o.addr}</td>
                                <td>${o.user}</td>
                                <td><span class="badge ${o.status === 'PENDENTE' ? 'badge-admin' : 'badge-func'}">${o.status}</span></td>
                            </tr>`;
                    });
                    osCount.innerText = count;
                });
                
                // Ponto em Tempo Real
                db.ref('hours/' + auth.currentUser.uid).limitToLast(5).on('value', snap => {
                    const container = document.getElementById('last-points');
                    container.innerHTML = '<h4>√öltimos registros:</h4>';
                    snap.forEach(child => {
                        container.innerHTML += `<div style="font-size:13px; padding:5px 0; border-bottom:1px solid #eee">üìÖ ${child.val().time}</div>`;
                    });
                });
            },

            loadAdminData() {
                db.ref('users').on('value', snap => {
                    const tbody = document.getElementById('users-table').querySelector('tbody');
                    tbody.innerHTML = '';
                    snap.forEach(child => {
                        const u = child.val();
                        tbody.innerHTML += `
                            <tr>
                                <td>${u.nome}</td>
                                <td>${u.email}</td>
                                <td><span class="badge badge-${u.role === 'ADMIN' ? 'admin' : u.role === 'FUNCIONARIO' ? 'func' : 'cid'}">${u.role}</span></td>
                                <td>
                                    <button class="btn btn-primary" style="padding:4px 8px; font-size:10px" onclick="App.changeRole('${child.key}', 'FUNCIONARIO')">Func</button>
                                    <button class="btn btn-primary" style="padding:4px 8px; font-size:10px; background:#1e293b" onclick="App.changeRole('${child.key}', 'ADMIN')">Admin</button>
                                </td>
                            </tr>`;
                    });
                });
            },

            publishNotice() {
                const title = document.getElementById('n-title').value;
                const desc = document.getElementById('n-desc').value;
                if(!title || !desc) return;
                db.ref('notices').push({
                    title, desc,
                    date: new Date().toLocaleDateString(),
                    author: this.currentUser.nome
                });
                UI.modal('modal-notice');
                UI.toast("Comunicado publicado!");
            },

            createOS() {
                const type = document.getElementById('os-type').value;
                const addr = document.getElementById('os-address').value;
                if(!addr) return;
                db.ref('os').push({
                    type, addr,
                    user: this.currentUser.nome,
                    status: 'PENDENTE'
                });
                UI.modal('modal-os');
                UI.toast("Chamado aberto com sucesso!");
            },

            registerPoint() {
                db.ref('hours/' + this.currentUser.uid).push({
                    time: new Date().toLocaleString()
                });
                UI.toast("Ponto registrado!");
            },

            changeRole(uid, role) {
                db.ref('users/' + uid + '/role').set(role);
                UI.toast("Cargo atualizado!");
            },

            updateClock() {
                setInterval(() => {
                    const now = new Date().toLocaleTimeString();
                    document.getElementById('real-time-clock').innerText = now;
                    if(document.getElementById('point-clock')) document.getElementById('point-clock').innerText = now;
                }, 1000);
            },

            initChart() {
                const ctx = document.getElementById('consumptionChart').getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
                        datasets: [{
                            label: 'Carga em MW',
                            data: [120, 95, 210, 340, 280, 410, 150],
                            borderColor: '#0062ff',
                            backgroundColor: 'rgba(0, 98, 255, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
        };

        // Inicializar aplica√ß√£o
        App.init();

    </script>
</body>
</html>
