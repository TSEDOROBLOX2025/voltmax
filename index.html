<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLTMAX - Energia que move a city</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --primary: #63B8FF;
            --primary-dark: #3a8ccf;
            --secondary: #0f172a;
            --white: #FFFFFF;
            --gray-light: #f4f6f9;
            --text-dark: #333333;
            --text-light: #666666;
            --danger: #ff4d4d;
            --success: #2ecc71;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 8px;
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; transition: all 0.3s ease; }
        body { background-color: var(--gray-light); color: var(--text-dark); overflow-x: hidden; }
        
        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .btn { padding: 10px 20px; border: none; border-radius: var(--radius); cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background-color: var(--primary); color: var(--white); }
        .btn-primary:hover { background-color: var(--primary-dark); transform: translateY(-2px); }
        .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
        .btn-danger { background-color: var(--danger); color: white; }
        
        /* --- HEADER & NAV --- */
        header { background: var(--white); box-shadow: var(--shadow); position: fixed; width: 100%; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; }
        .logo { font-size: 24px; font-weight: 700; color: var(--primary-dark); display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .logo i { font-size: 28px; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { text-decoration: none; color: var(--text-dark); font-weight: 500; }
        .nav-links a:hover { color: var(--primary); }

        /* --- HERO SECTION --- */
        .hero { height: 100vh; background: linear-gradient(135deg, rgba(99,184,255,0.9), rgba(15,23,42,0.8)), url('https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?auto=format&fit=crop&q=80'); background-size: cover; background-attachment: fixed; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; padding: 20px; padding-top: 80px; }
        .hero h1 { font-size: 3.5rem; margin-bottom: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .hero p { font-size: 1.2rem; margin-bottom: 30px; max-width: 600px; }
        
        /* --- CARDS & GRID --- */
        .container { max-width: 1200px; margin: 100px auto 40px; padding: 20px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--white); padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); border-top: 4px solid var(--primary); }
        .card h3 { color: var(--secondary); margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        /* --- FORMS --- */
        .login-wrapper { display: flex; justify-content: center; align-items: center; height: 100vh; background: #e0e7ff; }
        .login-box { background: white; padding: 40px; border-radius: var(--radius); box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-light); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: var(--radius); outline: none; }
        .form-group input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99,184,255,0.2); }

        /* --- TABLE --- */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: var(--primary); color: white; font-weight: 600; }
        tr:hover { background-color: #f9f9f9; }
        
        /* --- NOTICES --- */
        .notice-item { border-left: 4px solid var(--primary); background: white; padding: 15px; margin-bottom: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .notice-badge { font-size: 0.75rem; padding: 4px 8px; border-radius: 12px; background: #eee; font-weight: bold; }
        .notice-emergency { border-left-color: var(--danger); }
        .notice-emergency .notice-badge { background: #ffebeb; color: var(--danger); }

        /* --- TOAST --- */
        .toast { position: fixed; bottom: 20px; right: 20px; background: var(--secondary); color: white; padding: 12px 24px; border-radius: var(--radius); z-index: 2000; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .nav-container { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

    <header id="main-header">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-bolt"></i> VOLTMAX
            </div>
            <nav class="nav-links">
                <a href="#" onclick="app.router('home')">Home</a>
                <a href="#services">Serviços</a>
                <a href="#contact">Contato</a>
                <a href="#" id="login-btn-nav" class="btn btn-primary" onclick="app.router('login')">Entrar</a>
                <a href="#" id="logout-btn-nav" class="btn btn-danger hidden" onclick="app.auth.logout()">Sair</a>
            </nav>
        </div>
    </header>

    <main id="view-home">
        <section class="hero">
            <h1>Energia que move a city</h1>
            <p>Confiabilidade, tecnologia e sustentabilidade para o seu dia a dia.</p>
            <div>
                <button class="btn btn-primary" onclick="app.router('login')">Área do Cliente</button>
                <button class="btn btn-outline" style="border-color: white; color: white;" onclick="window.scrollTo(0, 800)">Serviços</button>
            </div>
        </section>

        <section class="container" id="public-notices">
            <h2><i class="fas fa-bullhorn"></i> Últimos Avisos à População</h2>
            <div id="home-notices-list" style="margin-top: 20px;">
                <p style="text-align: center; color: #777;">Carregando avisos...</p>
            </div>
        </section>

        <footer style="background: var(--secondary); color: white; padding: 40px 20px; text-align: center; margin-top: 50px;">
            <div class="logo" style="justify-content: center; margin-bottom: 20px; color: var(--primary);">
                <i class="fas fa-bolt"></i> VOLTMAX
            </div>
            <p>&copy; 2024 VOLTMAX Energia S.A. Todos os direitos reservados.</p>
        </footer>
    </main>

    <main id="view-login" class="hidden login-wrapper">
        <div class="login-box">
            <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                <i class="fas fa-bolt"></i> VOLTMAX
            </div>
            <h2 style="margin-bottom: 20px;">Portal Corporativo</h2>
            <form onsubmit="app.auth.login(event)">
                <div class="form-group">
                    <label>Usuário</label>
                    <input type="text" id="login-user" required placeholder="Digite seu usuário">
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="login-pass" required placeholder="Digite sua senha">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Acessar Sistema</button>
            </form>
            <p style="margin-top: 15px; font-size: 0.8rem; color: #888;">
                <i class="fas fa-lock"></i> Acesso seguro e monitorado.
            </p>
        </div>
    </main>

    <main id="view-citizen" class="hidden container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2><i class="fas fa-user"></i> Painel do Cidadão</h2>
            <span id="welcome-citizen" style="color: var(--primary);">Bem-vindo</span>
        </div>
        
        <div class="card">
            <h3>Avisos Oficiais e Interrupções</h3>
            <div id="citizen-notices-list">
                </div>
        </div>
    </main>

    <main id="view-employee" class="hidden container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2><i class="fas fa-hard-hat"></i> Portal do Colaborador</h2>
            <span id="welcome-employee" style="color: var(--primary);"></span>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3>Registro de Ponto</h3>
                <div style="text-align: center; padding: 20px;">
                    <h1 id="clock-display" style="font-size: 3rem; margin-bottom: 20px; color: var(--secondary);">00:00</h1>
                    <form onsubmit="app.employee.registerTime(event)">
                        <div class="form-group">
                            <input type="text" id="work-activity" placeholder="Atividade (ex: Manutenção na Subestação)" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="work-obs" placeholder="Observações (Opcional)">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;"><i class="fas fa-clock"></i> Registrar Ponto</button>
                    </form>
                </div>
            </div>

            <div class="card">
                <h3>Minhas Horas (Hoje)</h3>
                <div id="employee-today-hours">
                    <p>Carregando...</p>
                </div>
                <div style="margin-top: 20px; font-weight: bold; font-size: 1.2rem; color: var(--primary);">
                    Total Hoje: <span id="employee-total-hours">0h</span>
                </div>
            </div>
        </div>
    </main>

    <main id="view-admin" class="hidden container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2><i class="fas fa-user-shield"></i> Painel Administrativo</h2>
            <span id="welcome-admin" style="color: var(--primary);">Administrador</span>
        </div>

        <div class="dashboard-grid" style="margin-bottom: 30px;">
            <div class="card" style="text-align: center;">
                <h3>Total Usuários</h3>
                <h2 id="stats-users">0</h2>
            </div>
            <div class="card" style="text-align: center;">
                <h3>Total Horas (Mês)</h3>
                <h2 id="stats-hours">0h</h2>
            </div>
            <div class="card" style="text-align: center;">
                <h3>Avisos Ativos</h3>
                <h2 id="stats-notices">0</h2>
            </div>
        </div>

        <div class="card" style="margin-bottom: 30px;">
            <h3>Gestão de Usuários e Cargos</h3>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                <h4>Novo Usuário</h4>
                <form onsubmit="app.admin.createUser(event)" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: flex-end;">
                    <div class="form-group" style="margin:0; flex: 1;">
                        <input type="text" id="new-username" placeholder="Nome de Usuário" required>
                    </div>
                    <div class="form-group" style="margin:0; flex: 1;">
                        <input type="password" id="new-password" placeholder="Senha" required>
                    </div>
                    <button type="submit" class="btn btn-success" style="background-color: var(--success); color: white;">
                        <i class="fas fa-plus"></i> Criar
                    </button>
                </form>
            </div>

            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Usuário</th>
                            <th>Cargo Atual</th>
                            <th>Ações (Promover/Rebaixar)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="admin-users-list"></tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h3>Publicar Aviso Oficial</h3>
            <form onsubmit="app.admin.postNotice(event)">
                <div class="dashboard-grid">
                    <div class="form-group">
                        <label>Título</label>
                        <input type="text" id="notice-title" required>
                    </div>
                    <div class="form-group">
                        <label>Bairro</label>
                        <input type="text" id="notice-neighborhood" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo</label>
                        <select id="notice-type">
                            <option value="Manutenção">Manutenção</option>
                            <option value="Emergência">Emergência</option>
                            <option value="Geral">Aviso Geral</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Descrição</label>
                    <textarea id="notice-desc" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Publicar Aviso</button>
            </form>
            
            <h4 style="margin-top: 20px;">Avisos Recentes</h4>
            <div id="admin-notices-list" style="margin-top: 10px;"></div>
        </div>
    </main>

    <script>
        const DB_URL = "https://voltmax-empresa-default-rtdb.firebaseio.com";

        // --- UTILS ---
        const $ = (id) => document.getElementById(id);
        const formatTime = (date) => new Date(date).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
        const formatDate = (date) => new Date(date).toLocaleDateString('pt-BR');
        
        async function hashPassword(message) {
            // Simulação de hash simples para demo (em produção use libs robustas ou Auth service)
            // Aqui usamos um hash SHA-256 real via Web Crypto API
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function showToast(msg) {
            const div = document.createElement('div');
            div.className = 'toast';
            div.innerText = msg;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }

        // --- APP CORE ---
        const app = {
            state: {
                currentUser: JSON.parse(sessionStorage.getItem('voltmax_user')) || null,
                users: {},
                notices: [],
                hours: []
            },

            init: async function() {
                this.updateClock();
                setInterval(this.updateClock, 1000);
                
                // Verifica Admin Padrão na inicialização
                await this.checkDefaultAdmin();
                
                // Carrega dados iniciais públicos
                await this.fetchNotices();

                if (this.state.currentUser) {
                    this.router(this.getDashboardByRole(this.state.currentUser.role));
                } else {
                    this.router('home');
                }
            },

            updateClock: function() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
                if($('clock-display')) $('clock-display').innerText = timeString;
            },

            checkDefaultAdmin: async function() {
                const res = await fetch(`${DB_URL}/users.json`);
                const users = await res.json();
                let adminExists = false;
                
                if(users) {
                    Object.values(users).forEach(u => {
                        if(u.role === 'ADMIN') adminExists = true;
                    });
                }

                if (!adminExists) {
                    const passHash = await hashPassword('acessluk');
                    const adminUser = {
                        username: 'admin',
                        password: passHash,
                        role: 'ADMIN',
                        status: 'active'
                    };
                    await fetch(`${DB_URL}/users.json`, {
                        method: 'POST',
                        body: JSON.stringify(adminUser)
                    });
                    console.log("Admin padrão criado.");
                }
            },

            fetchNotices: async function() {
                const res = await fetch(`${DB_URL}/notices.json`);
                const data = await res.json();
                this.state.notices = data ? Object.entries(data).map(([key, val]) => ({id: key, ...val})).reverse() : [];
                this.renderNotices();
            },

            renderNotices: function() {
                const listHtml = this.state.notices.map(n => `
                    <div class="notice-item ${n.type === 'Emergência' ? 'notice-emergency' : ''}">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <span class="notice-badge">${n.type}</span>
                            <small>${n.date} - ${n.neighborhood}</small>
                        </div>
                        <strong>${n.title}</strong>
                        <p style="margin-top:5px; font-size:0.9rem; color:#555;">${n.description}</p>
                        ${this.state.currentUser?.role === 'ADMIN' ? `<button onclick="app.admin.deleteNotice('${n.id}')" style="font-size:0.8rem; color:red; border:none; background:none; cursor:pointer; margin-top:5px;">Excluir</button>` : ''}
                    </div>
                `).join('');

                if($('home-notices-list')) $('home-notices-list').innerHTML = listHtml || '<p>Nenhum aviso no momento.</p>';
                if($('citizen-notices-list')) $('citizen-notices-list').innerHTML = listHtml || '<p>Nenhum aviso no momento.</p>';
                if($('admin-notices-list')) $('admin-notices-list').innerHTML = listHtml;
            },

            getDashboardByRole: function(role) {
                switch(role) {
                    case 'ADMIN': return 'admin';
                    case 'FUNCIONARIO': return 'employee';
                    default: return 'citizen';
                }
            },

            router: function(viewName) {
                // Esconde tudo
                document.querySelectorAll('main').forEach(el => el.classList.add('hidden'));
                $('main-header').classList.remove('hidden');

                // Lógica de visualização
                if(viewName === 'login') {
                    $('view-login').classList.remove('hidden');
                    $('main-header').classList.add('hidden'); // Login fullscreen
                } else if (viewName === 'home') {
                    $('view-home').classList.remove('hidden');
                } else if (viewName === 'citizen') {
                    $('view-citizen').classList.remove('hidden');
                    $('welcome-citizen').innerText = `Olá, ${this.state.currentUser.username}`;
                } else if (viewName === 'employee') {
                    $('view-employee').classList.remove('hidden');
                    $('welcome-employee').innerText = `Colaborador: ${this.state.currentUser.username}`;
                    this.employee.loadHours();
                } else if (viewName === 'admin') {
                    $('view-admin').classList.remove('hidden');
                    this.admin.loadData();
                }

                // Ajusta botões do menu
                if(this.state.currentUser) {
                    $('login-btn-nav').classList.add('hidden');
                    $('logout-btn-nav').classList.remove('hidden');
                } else {
                    $('login-btn-nav').classList.remove('hidden');
                    $('logout-btn-nav').classList.add('hidden');
                }
            },

            // --- AUTHENTICATION ---
            auth: {
                login: async function(e) {
                    e.preventDefault();
                    const user = $('login-user').value;
                    const pass = $('login-pass').value;
                    const passHash = await hashPassword(pass);

                    try {
                        const res = await fetch(`${DB_URL}/users.json`);
                        const usersData = await res.json();
                        let foundUser = null;
                        let userId = null;

                        if(usersData) {
                            for(const [key, u] of Object.entries(usersData)) {
                                if(u.username === user && u.password === passHash) {
                                    foundUser = u;
                                    userId = key;
                                    break;
                                }
                            }
                        }

                        if(foundUser) {
                            if(foundUser.status === 'blocked') {
                                showToast('Conta bloqueada. Contate o administrador.');
                                return;
                            }
                            foundUser.id = userId; // Guarda ID para refs
                            app.state.currentUser = foundUser;
                            sessionStorage.setItem('voltmax_user', JSON.stringify(foundUser));
                            
                            // 4. Sistema Redireciona Automaticamente
                            const targetView = app.getDashboardByRole(foundUser.role);
                            showToast(`Bem-vindo, ${foundUser.username}!`);
                            app.router(targetView);
                        } else {
                            showToast('Usuário ou senha inválidos.');
                        }
                    } catch(err) {
                        console.error(err);
                        showToast('Erro de conexão.');
                    }
                },
                logout: function() {
                    app.state.currentUser = null;
                    sessionStorage.removeItem('voltmax_user');
                    app.router('home');
                    showToast('Você saiu do sistema.');
                }
            },

            // --- EMPLOYEE LOGIC ---
            employee: {
                registerTime: async function(e) {
                    e.preventDefault();
                    const activity = $('work-activity').value;
                    const obs = $('work-obs').value;
                    const now = new Date();

                    const record = {
                        userId: app.state.currentUser.id,
                        username: app.state.currentUser.username,
                        date: now.toLocaleDateString('pt-BR'),
                        timestamp: now.getTime(), // Para ordenação
                        time: now.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'}),
                        activity: activity,
                        obs: obs
                    };

                    await fetch(`${DB_URL}/hours.json`, {
                        method: 'POST',
                        body: JSON.stringify(record)
                    });

                    $('work-activity').value = '';
                    $('work-obs').value = '';
                    showToast('Ponto registrado com sucesso!');
                    this.loadHours();
                },
                loadHours: async function() {
                    // Carrega horas do usuário atual
                    const res = await fetch(`${DB_URL}/hours.json?orderBy="userId"&equalTo="${app.state.currentUser.id}"`);
                    // Nota: Firebase REST query simples requer indexação, se falhar, filtraremos no client-side para o demo
                    let data = {};
                    try {
                         // Fallback: carregar tudo e filtrar (não ideal para prod, mas ok para demo sem regras de index)
                         const r = await fetch(`${DB_URL}/hours.json`);
                         const all = await r.json();
                         if(all) {
                             Object.entries(all).forEach(([k, v]) => {
                                 if(v.userId === app.state.currentUser.id) data[k] = v;
                             });
                         }
                    } catch (e) { console.log(e); }

                    const today = new Date().toLocaleDateString('pt-BR');
                    const records = Object.values(data).filter(r => r.date === today).sort((a,b) => b.timestamp - a.timestamp);
                    
                    let html = '';
                    if(records.length === 0) html = '<p>Nenhum registro hoje.</p>';
                    else {
                        html = records.map(r => `
                            <div style="border-bottom:1px solid #eee; padding: 8px 0;">
                                <strong>${r.time}</strong> - ${r.activity}
                            </div>
                        `).join('');
                    }
                    $('employee-today-hours').innerHTML = html;
                    
                    // Calculo aproximado de horas (Exemplo: cada 2 registros contam um intervalo, ou apenas contagem de registros)
                    // Para simplificar neste escopo: Mostramos qtd de registros
                    $('employee-total-hours').innerText = `${records.length} registros`;
                }
            },

            // --- ADMIN LOGIC ---
            admin: {
                loadData: async function() {
                    app.fetchNotices(); // Atualiza avisos
                    
                    // Carregar Usuários
                    const resUsers = await fetch(`${DB_URL}/users.json`);
                    const users = await resUsers.json();
                    const tBody = $('admin-users-list');
                    tBody.innerHTML = '';
                    let countUsers = 0;

                    if(users) {
                        Object.entries(users).forEach(([id, u]) => {
                            countUsers++;
                            // Não permitir alterar o próprio admin logado via UI simples para evitar lockout
                            const isSelf = id === app.state.currentUser.id;
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${u.username}</td>
                                <td><span style="padding:4px 8px; background:${u.role==='ADMIN'?'#333':u.role==='FUNCIONARIO'?'var(--primary)':'#ccc'}; color:white; border-radius:4px; font-size:0.8rem;">${u.role}</span></td>
                                <td>
                                    ${!isSelf ? `
                                    <button onclick="app.admin.changeRole('${id}', 'CIDADAO')" class="btn" style="padding:2px 5px; font-size:0.7rem; background:#ccc;">Cidadão</button>
                                    <button onclick="app.admin.changeRole('${id}', 'FUNCIONARIO')" class="btn" style="padding:2px 5px; font-size:0.7rem; background:var(--primary); color:white;">Func</button>
                                    <button onclick="app.admin.changeRole('${id}', 'ADMIN')" class="btn" style="padding:2px 5px; font-size:0.7rem; background:var(--secondary); color:white;">Admin</button>
                                    ` : 'Atual'}
                                </td>
                                <td>${u.status}</td>
                            `;
                            tBody.appendChild(row);
                        });
                    }
                    $('stats-users').innerText = countUsers;
                    $('stats-notices').innerText = app.state.notices.length;
                },

                createUser: async function(e) {
                    e.preventDefault();
                    const username = $('new-username').value;
                    const password = $('new-password').value;
                    const passHash = await hashPassword(password);

                    const newUser = {
                        username: username,
                        password: passHash,
                        role: 'CIDADAO', // Default sempre Cidadão
                        status: 'active'
                    };

                    await fetch(`${DB_URL}/users.json`, { method: 'POST', body: JSON.stringify(newUser) });
                    $('new-username').value = '';
                    $('new-password').value = '';
                    showToast('Usuário criado com sucesso!');
                    app.admin.loadData();
                },

                changeRole: async function(userId, newRole) {
                    await fetch(`${DB_URL}/users/${userId}.json`, {
                        method: 'PATCH',
                        body: JSON.stringify({ role: newRole })
                    });
                    showToast('Cargo atualizado!');
                    app.admin.loadData();
                },

                postNotice: async function(e) {
                    e.preventDefault();
                    const notice = {
                        title: $('notice-title').value,
                        neighborhood: $('notice-neighborhood').value,
                        type: $('notice-type').value,
                        description: $('notice-desc').value,
                        date: new Date().toLocaleDateString('pt-BR')
                    };

                    await fetch(`${DB_URL}/notices.json`, { method: 'POST', body: JSON.stringify(notice) });
                    showToast('Aviso publicado!');
                    e.target.reset();
                    app.admin.loadData();
                },
                
                deleteNotice: async function(id) {
                    if(confirm('Tem certeza?')) {
                        await fetch(`${DB_URL}/notices/${id}.json`, { method: 'DELETE' });
                        showToast('Aviso removido.');
                        app.fetchNotices();
                        // Se estiver no painel admin, recarrega a lista específica
                        if(!document.getElementById('view-admin').classList.contains('hidden')) {
                            app.admin.loadData();
                        }
                    }
                }
            }
        };

        // Inicializa o app
        document.addEventListener('DOMContentLoaded', () => app.init());

    </script>
</body>
</html>
