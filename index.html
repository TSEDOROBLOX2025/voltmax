<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLTMAX - A Energia Que Move A City</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- DESIGN SYSTEM VOLTMAX --- */
        :root {
            --primary: #63B8FF; /* Azul Claro Oficial */
            --primary-dark: #3a8ccf;
            --primary-light: #e0f2fe;
            --secondary: #0f172a; /* Azul Petr√≥leo Corporativo */
            --white: #FFFFFF;
            --bg-gray: #f8fafc;
            --text-main: #334155;
            --text-light: #64748b;
            --danger: #ef4444;
            --success: #10b981;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 8px;
        }

        /* --- GLOBAL RESET --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; transition: all 0.2s ease-in-out; }
        body { background-color: var(--bg-gray); color: var(--text-main); line-height: 1.6; overflow-x: hidden; }
        
        /* --- UTILS --- */
        .hidden { display: none !important; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* --- BUTTONS --- */
        .btn { display: inline-block; padding: 12px 24px; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer; text-decoration: none; font-size: 0.95rem; }
        .btn-primary { background-color: var(--primary); color: var(--white); box-shadow: 0 4px 14px rgba(99, 184, 255, 0.4); }
        .btn-primary:hover { background-color: var(--primary-dark); transform: translateY(-2px); }
        .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
        .btn-outline:hover { background: var(--primary-light); }
        .btn-danger { background-color: var(--danger); color: white; padding: 6px 12px; font-size: 0.8rem; }
        .btn-sm { padding: 6px 12px; font-size: 0.85rem; }

        /* --- HEADER --- */
        header { background: var(--white); box-shadow: var(--shadow); position: fixed; width: 100%; top: 0; z-index: 1000; height: 70px; display: flex; align-items: center; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 40px; }
        .brand { font-size: 24px; font-weight: 800; color: var(--secondary); display: flex; align-items: center; gap: 10px; letter-spacing: -0.5px; }
        .brand span { color: var(--primary); }
        .nav-menu a { margin-left: 20px; text-decoration: none; color: var(--text-main); font-weight: 500; }
        .nav-menu a:hover { color: var(--primary); }
        .nav-actions { display: flex; gap: 10px; }

        /* --- HERO --- */
        .hero { height: 100vh; background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(99,184,255,0.8)), url('https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?q=80&w=2070'); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; text-align: center; color: white; padding-top: 70px; }
        .hero-content h1 { font-size: 3.5rem; margin-bottom: 20px; font-weight: 800; }
        .hero-content p { font-size: 1.25rem; margin-bottom: 40px; opacity: 0.9; }

        /* --- FORMS (LOGIN/REGISTER) --- */
        .auth-container { height: 100vh; display: flex; justify-content: center; align-items: center; background: #eef2f6; padding-top: 50px; }
        .auth-card { background: white; padding: 40px; width: 100%; max-width: 400px; border-radius: var(--radius); box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; border-top: 5px solid var(--primary); }
        .auth-card h2 { margin-bottom: 10px; color: var(--secondary); }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-light); }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: var(--radius); outline: none; }
        .form-group input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99,184,255,0.2); }
        .link-text { font-size: 0.9rem; margin-top: 15px; display: block; color: var(--text-light); }
        .link-text a { color: var(--primary); text-decoration: none; font-weight: 600; }

        /* --- DASHBOARDS --- */
        .dashboard-header { margin-top: 100px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #f1f5f9; }
        .card h3 { margin-bottom: 15px; color: var(--secondary); display: flex; align-items: center; gap: 10px; }
        
        /* --- TABLE --- */
        .table-responsive { overflow-x: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: var(--radius); overflow: hidden; }
        th { background: var(--secondary); color: white; padding: 12px; text-align: left; font-size: 0.9rem; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        
        /* --- NOTIFICATIONS --- */
        .toast { position: fixed; bottom: 20px; right: 20px; background: var(--secondary); color: white; padding: 15px 25px; border-radius: var(--radius); z-index: 2000; animation: slideUp 0.3s ease; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- NOTICE ITEMS --- */
        .notice-item { border-left: 4px solid var(--primary); padding: 15px; background: #f8fafc; margin-bottom: 10px; border-radius: 0 8px 8px 0; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .badge-admin { background: #1e293b; color: white; }
        .badge-func { background: var(--primary); color: white; }
        .badge-citizen { background: #94a3b8; color: white; }
    </style>
</head>
<body>

    <header id="main-header">
        <div class="nav-container">
            <div class="brand">
                <i class="fas fa-bolt"></i> VOLT<span>MAX</span>
            </div>
            <nav class="nav-menu">
                <a href="#" onclick="router.navigate('home')">In√≠cio</a>
                <a href="#" onclick="router.navigate('home')">Servi√ßos</a>
                <a href="#" onclick="router.navigate('home')">Contato</a>
            </nav>
            <div class="nav-actions" id="nav-auth-buttons">
                </div>
        </div>
    </header>

    <main id="view-home" class="view">
        <section class="hero">
            <div class="hero-content">
                <h1>Energia que move a city</h1>
                <p>Tecnologia, sustentabilidade e compromisso com o futuro.</p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-primary" onclick="router.navigate('login')">Acessar Minha Conta</button>
                    <button class="btn btn-outline" style="border-color: white; color: white;" onclick="router.navigate('register')">Criar Nova Conta</button>
                </div>
            </div>
        </section>
        
        <section class="container" style="padding: 60px 20px;">
            <h2 style="text-align: center; margin-bottom: 40px; color: var(--secondary);">Nossos Servi√ßos</h2>
            <div class="card-grid">
                <div class="card">
                    <i class="fas fa-file-invoice fa-2x" style="color: var(--primary); margin-bottom: 15px;"></i>
                    <h3>Segunda Via</h3>
                    <p>Emita a segunda via da sua fatura de forma r√°pida e segura.</p>
                </div>
                <div class="card">
                    <i class="fas fa-hard-hat fa-2x" style="color: var(--primary); margin-bottom: 15px;"></i>
                    <h3>Manuten√ß√£o</h3>
                    <p>Solicite reparos na rede el√©trica ou informe quedas de energia.</p>
                </div>
                <div class="card">
                    <i class="fas fa-leaf fa-2x" style="color: var(--primary); margin-bottom: 15px;"></i>
                    <h3>Sustentabilidade</h3>
                    <p>Conhe√ßa nossos projetos de energia renov√°vel.</p>
                </div>
            </div>
        </section>
    </main>

    <main id="view-login" class="view hidden auth-container">
        <div class="auth-card">
            <div class="brand" style="justify-content: center; margin-bottom: 20px;">
                <i class="fas fa-bolt"></i> VOLT<span>MAX</span>
            </div>
            <h2>Acesso ao Sistema</h2>
            <form onsubmit="auth.login(event)">
                <div class="form-group">
                    <label>Nome de Usu√°rio</label>
                    <input type="text" id="login-user" required placeholder="Seu usu√°rio">
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="login-pass" required placeholder="Sua senha">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Entrar</button>
            </form>
            <span class="link-text">N√£o tem conta? <a href="#" onclick="router.navigate('register')">Criar conta agora</a></span>
        </div>
    </main>

    <main id="view-register" class="view hidden auth-container">
        <div class="auth-card">
            <div class="brand" style="justify-content: center; margin-bottom: 20px;">
                <i class="fas fa-bolt"></i> VOLT<span>MAX</span>
            </div>
            <h2>Criar Nova Conta</h2>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 20px;">Sua conta ser√° criada como CIDAD√ÉO.</p>
            <form onsubmit="auth.register(event)">
                <div class="form-group">
                    <label>Escolha um Usu√°rio</label>
                    <input type="text" id="reg-user" required placeholder="Ex: joaosilva">
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="reg-pass" required placeholder="M√≠nimo 6 caracteres">
                </div>
                <div class="form-group">
                    <label>Confirmar Senha</label>
                    <input type="password" id="reg-pass-confirm" required placeholder="Repita a senha">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Criar Conta</button>
            </form>
            <span class="link-text">J√° tem conta? <a href="#" onclick="router.navigate('login')">Fazer Login</a></span>
        </div>
    </main>

    <main id="view-citizen" class="view hidden container">
        <div class="dashboard-header">
            <div>
                <h2>√Årea do Cidad√£o</h2>
                <p>Avisos oficiais e comunicados para seu bairro.</p>
            </div>
            <div class="badge badge-citizen">Perfil Cidad√£o</div>
        </div>
        <div class="card">
            <h3><i class="fas fa-bullhorn"></i> Quadro de Avisos</h3>
            <div id="citizen-notices-list">Loading...</div>
        </div>
    </main>

    <main id="view-employee" class="view hidden container">
        <div class="dashboard-header">
            <div>
                <h2>Portal do Colaborador</h2>
                <p id="emp-welcome">Bem-vindo √† √°rea interna.</p>
            </div>
            <div class="badge badge-func">Funcion√°rio</div>
        </div>

        <div class="card-grid">
            <div class="card" style="text-align: center;">
                <h3>Registro de Ponto</h3>
                <h1 id="clock-display" style="font-size: 3rem; color: var(--secondary); margin: 20px 0;">00:00:00</h1>
                <button onclick="app.employee.clockIn()" class="btn btn-primary"><i class="fas fa-fingerprint"></i> Registrar Agora</button>
            </div>
            <div class="card">
                <h3>Meu Hist√≥rico Hoje</h3>
                <div id="employee-history-list" style="margin-top: 15px;"></div>
            </div>
        </div>
    </main>

    <main id="view-admin" class="view hidden container">
        <div class="dashboard-header">
            <div>
                <h2>Painel Administrativo</h2>
                <p>Gest√£o centralizada do sistema VOLTMAX.</p>
            </div>
            <div class="badge badge-admin">Administrador</div>
        </div>

        <div class="card-grid" style="margin-bottom: 30px;">
            <div class="card">
                <h3><i class="fas fa-users"></i> Gest√£o de Usu√°rios</h3>
                <p style="margin-bottom: 10px; font-size: 0.9rem; color: #666;">Promova cargos ou bloqueie acessos.</p>
                <div class="table-responsive">
                    <table id="admin-users-table">
                        <thead>
                            <tr>
                                <th>Usu√°rio</th>
                                <th>Cargo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3><i class="fas fa-newspaper"></i> Publicar Aviso</h3>
                <form onsubmit="app.admin.postNotice(event)">
                    <div class="form-group">
                        <input type="text" id="notice-title" placeholder="T√≠tulo do Aviso" required>
                    </div>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <input type="text" id="notice-bairro" placeholder="Bairro" required style="flex:1">
                        <select id="notice-type" style="padding:10px; border-radius:8px; border:1px solid #ccc;">
                            <option>Geral</option>
                            <option>Manuten√ß√£o</option>
                            <option>Emerg√™ncia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea id="notice-desc" rows="3" placeholder="Descri√ß√£o detalhada..." style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">Publicar</button>
                </form>
                <div id="admin-notices-preview" style="margin-top: 20px; max-height: 200px; overflow-y: auto;"></div>
            </div>
        </div>
    </main>

    <script>
        const DB_URL = "https://voltmax-empresa-default-rtdb.firebaseio.com";
        
        // --- UTILIT√ÅRIOS ---
        const $ = (id) => document.getElementById(id);
        const showToast = (msg) => {
            const div = document.createElement('div');
            div.className = 'toast';
            div.innerHTML = `<i class="fas fa-info-circle"></i> ${msg}`;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        };
        async function hashString(str) {
            const msgBuffer = new TextEncoder().encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // --- CORE APP ---
        const app = {
            user: null, // Usu√°rio logado
            
            init: async function() {
                // Rel√≥gio
                setInterval(() => {
                    const now = new Date();
                    if($('clock-display')) $('clock-display').innerText = now.toLocaleTimeString('pt-BR');
                }, 1000);

                // Check Admin Padr√£o
                await this.ensureAdminExists();

                // Recuperar Sess√£o
                const savedUser = sessionStorage.getItem('voltmax_session');
                if (savedUser) {
                    this.user = JSON.parse(savedUser);
                    router.checkPermissions();
                } else {
                    router.navigate('home');
                }
            },

            ensureAdminExists: async function() {
                // Verifica se admin existe, se n√£o cria (apenas para garantir o acesso inicial)
                try {
                    const res = await fetch(`${DB_URL}/users.json`);
                    const users = await res.json();
                    let adminFound = false;
                    if(users) {
                        Object.values(users).forEach(u => { if(u.username === 'admin') adminFound = true; });
                    }
                    
                    if(!adminFound) {
                        const passHash = await hashString('acessluk');
                        const adminData = { username: 'admin', password: passHash, role: 'ADMIN', status: 'active' };
                        await fetch(`${DB_URL}/users.json`, { method: 'POST', body: JSON.stringify(adminData) });
                        console.log("Sistema: Admin padr√£o restaurado.");
                    }
                } catch(e) { console.error("Erro conex√£o DB", e); }
            },

            // L√≥gica Espec√≠fica dos Pain√©is
            citizen: {
                load: async function() {
                    const res = await fetch(`${DB_URL}/notices.json`);
                    const data = await res.json();
                    const list = $('citizen-notices-list');
                    list.innerHTML = '';
                    
                    if(!data) { list.innerHTML = '<p>Nenhum aviso no momento.</p>'; return; }

                    Object.entries(data).reverse().forEach(([id, item]) => {
                        const div = document.createElement('div');
                        div.className = 'notice-item';
                        div.innerHTML = `
                            <div style="display:flex; justify-content:space-between;">
                                <strong>${item.titulo}</strong>
                                <span style="font-size:0.8rem; color:#666;">${item.data}</span>
                            </div>
                            <p style="font-size:0.9rem; margin: 5px 0;">${item.descricao}</p>
                            <small>üìç ${item.bairro} | Tipo: ${item.tipo}</small>
                        `;
                        list.appendChild(div);
                    });
                }
            },

            employee: {
                load: async function() {
                    $('emp-welcome').innerText = `Ol√°, ${app.user.username}. Registre suas atividades.`;
                    this.loadHistory();
                },
                clockIn: async function() {
                    const now = new Date();
                    const record = {
                        user_id: app.user.id,
                        data: now.toLocaleDateString('pt-BR'),
                        hora: now.toLocaleTimeString('pt-BR'),
                        timestamp: now.getTime()
                    };
                    await fetch(`${DB_URL}/hours.json`, { method: 'POST', body: JSON.stringify(record) });
                    showToast("Ponto registrado com sucesso!");
                    this.loadHistory();
                },
                loadHistory: async function() {
                    // Fetch simples e filtro no client (para demo)
                    const res = await fetch(`${DB_URL}/hours.json`);
                    const data = await res.json();
                    const list = $('employee-history-list');
                    list.innerHTML = '';
                    
                    if(data) {
                        const myRecs = Object.values(data)
                            .filter(r => r.user_id === app.user.id) // Filtra pelo ID do usu√°rio
                            .sort((a,b) => b.timestamp - a.timestamp)
                            .slice(0, 5); // Ultimos 5
                        
                        myRecs.forEach(r => {
                            list.innerHTML += `<div style="padding:8px; border-bottom:1px solid #eee;">‚úÖ ${r.data} √†s ${r.hora}</div>`;
                        });
                    }
                }
            },

            admin: {
                load: async function() {
                    this.loadUsers();
                    this.loadNotices();
                },
                loadUsers: async function() {
                    const res = await fetch(`${DB_URL}/users.json`);
                    const users = await res.json();
                    const tbody = $('admin-users-table').querySelector('tbody');
                    tbody.innerHTML = '';

                    if(users) {
                        Object.entries(users).forEach(([key, u]) => {
                            if(u.username === 'admin') return; // N√£o listar superadmin para edi√ß√£o simples

                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${u.username}</td>
                                <td><span class="badge ${u.role === 'ADMIN' ? 'badge-admin' : u.role === 'FUNCIONARIO' ? 'badge-func' : 'badge-citizen'}">${u.role}</span></td>
                                <td>${u.status}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline" onclick="app.admin.changeRole('${key}', 'CIDADAO')">Cid</button>
                                    <button class="btn btn-sm btn-primary" onclick="app.admin.changeRole('${key}', 'FUNCIONARIO')">Func</button>
                                    <button class="btn btn-sm btn-danger" onclick="app.admin.changeRole('${key}', 'ADMIN')">Adm</button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                },
                changeRole: async function(uid, newRole) {
                    await fetch(`${DB_URL}/users/${uid}.json`, {
                        method: 'PATCH',
                        body: JSON.stringify({ role: newRole })
                    });
                    showToast(`Cargo alterado para ${newRole}`);
                    this.loadUsers();
                },
                postNotice: async function(e) {
                    e.preventDefault();
                    const notice = {
                        titulo: $('notice-title').value,
                        bairro: $('notice-bairro').value,
                        tipo: $('notice-type').value,
                        descricao: $('notice-desc').value,
                        data: new Date().toLocaleDateString('pt-BR')
                    };
                    await fetch(`${DB_URL}/notices.json`, { method: 'POST', body: JSON.stringify(notice) });
                    showToast("Aviso publicado!");
                    e.target.reset();
                    this.loadNotices();
                },
                loadNotices: async function() {
                    const res = await fetch(`${DB_URL}/notices.json`);
                    const data = await res.json();
                    const div = $('admin-notices-preview');
                    div.innerHTML = '';
                    if(data) {
                        Object.entries(data).reverse().forEach(([k, v]) => {
                            div.innerHTML += `<div style="font-size:0.8rem; border-bottom:1px solid #eee; padding:5px;"><b>${v.titulo}</b> (${v.bairro}) <span style="color:red; cursor:pointer;" onclick="app.admin.deleteNotice('${k}')">[x]</span></div>`;
                        });
                    }
                },
                deleteNotice: async function(id) {
                    if(confirm("Excluir aviso?")) {
                        await fetch(`${DB_URL}/notices/${id}.json`, { method: 'DELETE' });
                        this.loadNotices();
                    }
                }
            }
        };

        // --- AUTH ---
        const auth = {
            login: async function(e) {
                e.preventDefault();
                const user = $('login-user').value;
                const pass = $('login-pass').value;
                const passHash = await hashString(pass);

                // Fetch all users to find match (No Realtime Database REST, n√£o d√° para filtrar por 2 campos ao mesmo tempo facilmente sem index, ent√£o faremos client-side filter para garantir integridade do login)
                try {
                    const res = await fetch(`${DB_URL}/users.json`);
                    const allUsers = await res.json();
                    
                    let foundUser = null;
                    if(allUsers) {
                        for(const [key, u] of Object.entries(allUsers)) {
                            if(u.username === user && u.password === passHash) {
                                foundUser = { ...u, id: key }; // Injeta o ID do firebase
                                break;
                            }
                        }
                    }

                    if(foundUser) {
                        if(foundUser.status === 'blocked') {
                            showToast("Conta bloqueada pelo administrador.");
                            return;
                        }
                        
                        app.user = foundUser;
                        sessionStorage.setItem('voltmax_session', JSON.stringify(foundUser));
                        showToast("Login realizado com sucesso!");
                        
                        // REDIRECIONAMENTO AUTOM√ÅTICO
                        router.redirectBasedOnRole();
                    } else {
                        showToast("Usu√°rio ou senha incorretos.");
                    }
                } catch(err) {
                    console.error(err);
                    showToast("Erro de conex√£o.");
                }
            },

            register: async function(e) {
                e.preventDefault();
                const user = $('reg-user').value;
                const pass = $('reg-pass').value;
                const confirm = $('reg-pass-confirm').value;

                if(pass !== confirm) return showToast("As senhas n√£o coincidem.");
                if(pass.length < 6) return showToast("Senha muito curta.");

                // Verifica se usuario ja existe
                const res = await fetch(`${DB_URL}/users.json`);
                const allUsers = await res.json();
                let exists = false;
                if(allUsers) {
                    Object.values(allUsers).forEach(u => { if(u.username === user) exists = true; });
                }

                if(exists) return showToast("Nome de usu√°rio j√° est√° em uso.");

                const passHash = await hashString(pass);
                const newUser = {
                    username: user,
                    password: passHash,
                    role: 'CIDADAO', // REGRA: Sempre come√ßa como cidad√£o
                    status: 'active'
                };

                await fetch(`${DB_URL}/users.json`, { method: 'POST', body: JSON.stringify(newUser) });
                showToast("Conta criada! Fa√ßa login.");
                router.navigate('login');
            },

            logout: function() {
                app.user = null;
                sessionStorage.removeItem('voltmax_session');
                router.navigate('home');
                showToast("Sess√£o encerrada.");
            }
        };

        // --- ROUTER ---
        const router = {
            navigate: function(viewName) {
                // Esconde todas as views
                document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
                $('main-header').classList.remove('hidden');

                // L√≥gica Auth Navbar
                const navAuth = $('nav-auth-buttons');
                if(app.user) {
                    navAuth.innerHTML = `
                        <span style="font-size:0.9rem; margin-right:10px;">Ol√°, <b>${app.user.username}</b></span>
                        <button class="btn btn-sm btn-danger" onclick="auth.logout()">Sair</button>
                    `;
                } else {
                    navAuth.innerHTML = `
                        <button class="btn btn-sm btn-outline" onclick="router.navigate('login')">Entrar</button>
                        <button class="btn btn-sm btn-primary" onclick="router.navigate('register')">Criar Conta</button>
                    `;
                }

                // Exibe a view alvo
                if(viewName === 'login') {
                    $('view-login').classList.remove('hidden');
                    $('main-header').classList.add('hidden'); // Login fullscreen
                } else if(viewName === 'register') {
                    $('view-register').classList.remove('hidden');
                    $('main-header').classList.add('hidden');
                } else {
                    $(`view-${viewName}`).classList.remove('hidden');
                }
            },

            redirectBasedOnRole: function() {
                if(!app.user) return this.navigate('login');
                
                switch(app.user.role) {
                    case 'ADMIN':
                        this.navigate('admin');
                        app.admin.load();
                        break;
                    case 'FUNCIONARIO':
                        this.navigate('employee');
                        app.employee.load();
                        break;
                    default: // CIDADAO
                        this.navigate('citizen');
                        app.citizen.load();
                        break;
                }
            },

            checkPermissions: function() {
                // Se tentar acessar uma rota sem estar logado, ou se estiver logado, manda pro painel correto
                if(app.user) {
                    this.redirectBasedOnRole();
                } else {
                    this.navigate('home');
                }
            }
        };

        // Iniciar
        document.addEventListener('DOMContentLoaded', () => app.init());

    </script>
</body>
</html>
