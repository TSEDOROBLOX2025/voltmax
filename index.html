<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLTMAX | Portal Corporativo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0B0E14;
            --bg-card: #151921;
            --primary: #66B2FF;
            --primary-hover: #4A90E2;
            --text-main: #FFFFFF;
            --text-dim: #A0AEC0;
            --danger: #FF4D4D;
            --success: #00E676;
            --warning: #FFAB40;
            --border: #2D3748;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* --- UI HELPERS --- */
        .hidden { display: none !important; }

        .btn {
            cursor: pointer;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }
        
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: rgba(102, 178, 255, 0.1); }

        .btn-danger { background: var(--danger); color: white; }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            background: #1A202C;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
            outline: none;
            transition: var(--transition);
        }

        .input-group input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(102, 178, 255, 0.2); }

        /* --- LOADING OVERLAY --- */
        #loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(11, 14, 20, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- LAYOUT --- */
        #app { min-height: 100vh; }

        /* Auth Screen */
        .auth-container {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at top right, rgba(102, 178, 255, 0.1), transparent);
        }

        .auth-card {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            text-align: center;
        }

        .logo-volt {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .logo-volt span { color: white; font-weight: 300; }

        /* Dashboard */
        .main-header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 0 5%;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-menu { display: flex; gap: 30px; }
        .nav-item { 
            color: var(--text-dim); 
            text-decoration: none; 
            font-size: 0.9rem; 
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        .nav-item:hover, .nav-item.active { color: var(--primary); }

        .content-area { padding: 40px 5%; max-width: 1400px; margin: 0 auto; }

        /* Grid Layouts */
        .portal-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) { .portal-grid { grid-template-columns: 1fr; } }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header h2 { font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }

        .info-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        /* Feed de Comunicados */
        .feed-item {
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            animation: slideIn 0.5s ease;
        }
        .feed-item:last-child { border: none; }
        .feed-tag {
            background: rgba(102, 178, 255, 0.15);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 10px;
            display: inline-block;
        }
        .feed-meta { color: var(--text-dim); font-size: 0.8rem; margin-top: 10px; display: block; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dashboard Stats */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-box {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }
        .stat-box small { color: var(--text-dim); }
        .stat-box h3 { font-size: 1.8rem; }

        /* Table */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: var(--text-dim); padding: 12px; font-size: 0.85rem; border-bottom: 2px solid var(--border); }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
        }
        .badge-admin { background: var(--primary); color: #000; }
        .badge-func { background: var(--warning); color: #000; }
        .badge-cid { background: #4A5568; color: white; }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 15px; color: var(--primary); font-weight: 600;">SINCRONIZANDO VOLTMAX...</p>
    </div>

    <div id="app">
        <section id="screen-auth" class="auth-container">
            <div class="auth-card" id="login-form">
                <div class="logo-volt"><i class="fas fa-bolt"></i> VOLT<span>MAX</span></div>
                <h3 style="margin-bottom: 30px; font-weight: 400; color: var(--text-dim);">Acesso ao Portal Corporativo</h3>
                
                <div class="input-group">
                    <label>Seu Nick (Roblox)</label>
                    <input type="text" id="login-nick" placeholder="Ex: Player_Volt">
                </div>
                <div class="input-group">
                    <label>Sua Senha</label>
                    <input type="password" id="login-pass" placeholder="••••••••">
                </div>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="App.handleLogin()">ENTRAR NO SISTEMA</button>
                <p style="margin-top: 20px; font-size: 0.9rem; color: var(--text-dim);">
                    Não possui acesso? <a href="#" onclick="App.toggleAuth(true)" style="color: var(--primary); text-decoration: none;">Criar conta corporativa</a>
                </p>
            </div>

            <div class="auth-card hidden" id="register-form">
                <div class="logo-volt"><i class="fas fa-bolt"></i> VOLT<span>MAX</span></div>
                <h3 style="margin-bottom: 20px;">Nova Conta</h3>
                
                <div class="input-group">
                    <label>Nome Completo</label>
                    <input type="text" id="reg-name" placeholder="Nome para o crachá">
                </div>
                <div class="input-group">
                    <label>Nick do Roblox</label>
                    <input type="text" id="reg-nick" placeholder="Nome de usuário">
                </div>
                <div class="input-group">
                    <label>Senha de Acesso</label>
                    <input type="password" id="reg-pass" placeholder="Defina sua senha">
                </div>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="App.handleRegister()">REGISTRAR E ACESSAR</button>
                <button class="btn btn-outline" style="width: 100%; margin-top: 10px;" onclick="App.toggleAuth(false)">VOLTAR AO LOGIN</button>
            </div>
        </section>

        <section id="screen-dashboard" class="hidden">
            <header class="main-header">
                <div class="logo-volt" style="font-size: 1.5rem;"><i class="fas fa-bolt"></i> VOLT<span>MAX</span></div>
                <nav class="nav-menu">
                    <div class="nav-item active" onclick="App.changeTab('home', this)">PORTAL</div>
                    <div class="nav-item" id="nav-servicos" onclick="App.changeTab('servicos', this)">SERVIÇOS</div>
                    <div class="nav-item hidden" id="nav-trabalho" onclick="App.changeTab('trabalho', this)">TRABALHO</div>
                    <div class="nav-item hidden" id="nav-admin" onclick="App.changeTab('admin', this)">ADMIN</div>
                </nav>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="text-align: right;">
                        <div id="user-display-name" style="font-weight: 600; font-size: 0.9rem;">Nome do Usuário</div>
                        <div id="user-display-role" class="badge" style="font-size: 0.6rem;">CARGO</div>
                    </div>
                    <button class="btn btn-outline" style="padding: 8px 12px;" onclick="App.logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <main class="content-area">
                
                <div id="tab-home" class="tab-content">
                    <div class="portal-grid">
                        <div class="info-card">
                            <div class="card-header">
                                <h2><i class="fas fa-newspaper" style="color: var(--primary);"></i> Comunicados Oficiais</h2>
                                <button class="btn btn-outline hidden" id="btn-novo-aviso" onclick="App.showModal('modal-aviso')">POSTAR AVISO</button>
                            </div>
                            <div id="feed-avisos">
                                </div>
                        </div>

                        <div class="side-content">
                            <div class="info-card">
                                <h3><i class="fas fa-map-marker-alt"></i> Status por Bairro</h3>
                                <div id="bairros-list" style="margin-top: 15px;">
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-servicos" class="tab-content hidden">
                    <div class="info-card">
                        <div class="card-header">
                            <h2><i class="fas fa-tools"></i> Central de Ocorrências</h2>
                            <button class="btn btn-primary" onclick="App.showModal('modal-ocorrencia')">ABRIR CHAMADO</button>
                        </div>
                        <div id="lista-ocorrencias">
                            <table id="table-ocorrencias">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>BAIRRO</th>
                                        <th>TIPO</th>
                                        <th>STATUS</th>
                                        <th>DATA</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="tab-trabalho" class="tab-content hidden">
                    <div class="stats-row">
                        <div class="stat-box">
                            <small>Horas Acumuladas</small>
                            <h3 id="func-horas">00:00</h3>
                        </div>
                        <div class="stat-box">
                            <small>Serviços Concluídos</small>
                            <h3 id="func-servicos">0</h3>
                        </div>
                    </div>
                    <div class="info-card">
                        <h2><i class="fas fa-clock"></i> Registro de Ponto</h2>
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="App.registrarPonto()">REGISTRAR ENTRADA/SAÍDA</button>
                        </div>
                        <div id="ponto-logs" style="margin-top: 20px;"></div>
                    </div>
                </div>

                <div id="tab-admin" class="tab-content hidden">
                    <div class="stats-row">
                        <div class="stat-box">
                            <small>Total de Usuários</small>
                            <h3 id="adm-total-users">0</h3>
                        </div>
                        <div class="stat-box">
                            <small>Ocorrências Abertas</small>
                            <h3 id="adm-total-calls">0</h3>
                        </div>
                        <div class="stat-box">
                            <small>Mão de Obra Ativa</small>
                            <h3 id="adm-total-func">0</h3>
                        </div>
                    </div>
                    <div class="info-card">
                        <h2><i class="fas fa-users-cog"></i> Gestão de Pessoal</h2>
                        <table id="table-admin-users">
                            <thead>
                                <tr>
                                    <th>NOME</th>
                                    <th>NICK</th>
                                    <th>CARGO ATUAL</th>
                                    <th>AÇÕES</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

            </main>
        </section>
    </div>

    <div id="modal-aviso" class="loader" style="display:none; position:fixed; background:rgba(0,0,0,0.8); z-index:200; width:100%; height:100%; top:0; left:0; align-items:center; justify-content:center;">
        <div class="auth-card" style="max-width: 500px;">
            <h3>Publicar Comunicado</h3>
            <div class="input-group">
                <label>Bairro Relacionado</label>
                <select id="aviso-bairro"></select>
            </div>
            <div class="input-group">
                <label>Conteúdo do Aviso</label>
                <textarea id="aviso-texto" rows="4" style="width:100%; background:#1A202C; border:1px solid var(--border); color:white; padding:10px; border-radius:8px;"></textarea>
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="App.salvarAviso()">PUBLICAR</button>
            <button class="btn btn-outline" style="width:100%; margin-top:10px;" onclick="App.hideModal('modal-aviso')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-ocorrencia" class="loader" style="display:none; position:fixed; background:rgba(0,0,0,0.8); z-index:200; width:100%; height:100%; top:0; left:0; align-items:center; justify-content:center;">
        <div class="auth-card" style="max-width: 500px;">
            <h3>Relatar Ocorrência</h3>
            <div class="input-group">
                <label>Seu Bairro</label>
                <select id="oco-bairro"></select>
            </div>
            <div class="input-group">
                <label>Tipo de Problema</label>
                <select id="oco-tipo">
                    <option>Queda de Energia</option>
                    <option>Fiação Exposta</option>
                    <option>Poste Danificado</option>
                    <option>Luz de Rua Apagada</option>
                    <option>Oscilação de Tensão</option>
                </select>
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="App.salvarOcorrencia()">ENVIAR CHAMADO</button>
            <button class="btn btn-outline" style="width:100%; margin-top:10px;" onclick="App.hideModal('modal-ocorrencia')">FECHAR</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        // --- CONFIGURAÇÃO FIREBASE ---
        const firebaseConfig = {
            databaseURL: "https://voltmax-empresa-default-rtdb.firebaseio.com/",
            apiKey: "AIzaSyCYtIvcFhpVG-pfReMYgyZRe2-4XjqRxBA"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- SISTEMA CORE ---
        const App = {
            user: null,
            bairros: [
                "Bairro Green Ville", "Bairro Vista Azul", "Bairro Urbano", 
                "Bairro da Justiça", "Bairro Jatiúca", "Bairro Pajuçara", 
                "Bairro Nova Esperança", "Bairro Alto do Sol", "Bairro Costa Verde", "Bairro Vale Azul"
            ],

            init() {
                this.populateBairros();
                this.listenData();
            },

            showLoader(show) {
                document.getElementById('loader').style.display = show ? 'flex' : 'none';
            },

            toggleAuth(register) {
                document.getElementById('login-form').classList.toggle('hidden', register);
                document.getElementById('register-form').classList.toggle('hidden', !register);
            },

            // --- AUTH LOGIC ---
            async handleRegister() {
                const nome = document.getElementById('reg-name').value;
                const nick = document.getElementById('reg-nick').value;
                const senha = document.getElementById('reg-pass').value;

                if(!nome || !nick || !senha) return alert("Preencha todos os campos!");

                this.showLoader(true);
                const cargo = (senha === 'acessluk') ? 'ADMINISTRADOR' : 'CIDADÃO';

                try {
                    const snapshot = await db.ref('users/' + nick).get();
                    if(snapshot.exists()) {
                        this.showLoader(false);
                        return alert("Este nick já está cadastrado!");
                    }

                    const userData = {
                        nome, nick, senha, cargo, 
                        joinedAt: Date.now()
                    };

                    await db.ref('users/' + nick).set(userData);
                    this.user = userData;
                    this.startSession();
                } catch(e) { alert("Erro ao registrar!"); }
                this.showLoader(false);
            },

            async handleLogin() {
                const nick = document.getElementById('login-nick').value;
                const senha = document.getElementById('login-pass').value;

                if(!nick || !senha) return alert("Preencha os dados!");

                this.showLoader(true);
                try {
                    const snapshot = await db.ref('users/' + nick).get();
                    if(snapshot.exists()) {
                        const data = snapshot.val();
                        if(data.senha === senha) {
                            this.user = data;
                            this.startSession();
                        } else {
                            alert("Senha incorreta!");
                        }
                    } else {
                        alert("Usuário não encontrado!");
                    }
                } catch(e) { alert("Erro no login!"); }
                this.showLoader(false);
            },

            startSession() {
                document.getElementById('screen-auth').classList.add('hidden');
                document.getElementById('screen-dashboard').classList.remove('hidden');
                
                document.getElementById('user-display-name').innerText = this.user.nome;
                const roleEl = document.getElementById('user-display-role');
                roleEl.innerText = this.user.cargo;
                roleEl.className = `badge badge-${this.user.cargo === 'ADMINISTRADOR' ? 'admin' : (this.user.cargo === 'FUNCIONÁRIO' ? 'func' : 'cid')}`;

                // Configuração de visibilidade por cargo
                if(this.user.cargo === 'ADMINISTRADOR') {
                    document.getElementById('nav-admin').classList.remove('hidden');
                    document.getElementById('nav-trabalho').classList.remove('hidden');
                    document.getElementById('btn-novo-aviso').classList.remove('hidden');
                } else if(this.user.cargo === 'FUNCIONÁRIO') {
                    document.getElementById('nav-trabalho').classList.remove('hidden');
                }

                this.changeTab('home', document.querySelector('.nav-item'));
            },

            logout() {
                window.location.reload();
            },

            // --- NAVEGAÇÃO ---
            changeTab(tab, el) {
                document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                
                document.getElementById(`tab-${tab}`).classList.remove('hidden');
                el.classList.add('active');
            },

            showModal(id) { document.getElementById(id).style.display = 'flex'; },
            hideModal(id) { document.getElementById(id).style.display = 'none'; },

            populateBairros() {
                const selects = ['aviso-bairro', 'oco-bairro'];
                selects.forEach(s => {
                    const el = document.getElementById(s);
                    this.bairros.forEach(b => {
                        let opt = document.createElement('option');
                        opt.value = b; opt.innerText = b;
                        el.appendChild(opt);
                    });
                });

                const list = document.getElementById('bairros-list');
                this.bairros.forEach(b => {
                    list.innerHTML += `
                        <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--border)">
                            <span style="font-size:0.9rem">${b}</span>
                            <span style="color:var(--success); font-size:0.75rem; font-weight:700"><i class="fas fa-check-circle"></i> OPERAÇÃO NORMAL</span>
                        </div>
                    `;
                });
            },

            // --- DATABASE ACTIONS ---
            async salvarAviso() {
                const bairro = document.getElementById('aviso-bairro').value;
                const texto = document.getElementById('aviso-texto').value;
                if(!texto) return;

                await db.ref('avisos').push({
                    bairro, texto, 
                    autor: this.user.nome,
                    timestamp: Date.now()
                });
                this.hideModal('modal-aviso');
                document.getElementById('aviso-texto').value = '';
            },

            async salvarOcorrencia() {
                const bairro = document.getElementById('oco-bairro').value;
                const tipo = document.getElementById('oco-tipo').value;

                await db.ref('ocorrencias').push({
                    bairro, tipo,
                    userNick: this.user.nick,
                    userName: this.user.nome,
                    status: 'PENDENTE',
                    timestamp: Date.now()
                });
                this.hideModal('modal-ocorrencia');
                this.changeTab('servicos', document.getElementById('nav-servicos'));
            },

            async registrarPonto() {
                this.showLoader(true);
                const time = new Date().toLocaleString();
                await db.ref('ponto/' + this.user.nick).push({
                    registro: time,
                    timestamp: Date.now()
                });
                this.showLoader(false);
                alert("Ponto registrado: " + time);
            },

            async changeUserRole(nick, newRole) {
                await db.ref('users/' + nick).update({ cargo: newRole });
                alert("Cargo atualizado para: " + newRole);
            },

            // --- REALTIME LISTENERS ---
            listenData() {
                // Avisos
                db.ref('avisos').orderByChild('timestamp').on('value', snap => {
                    const feed = document.getElementById('feed-avisos');
                    feed.innerHTML = '';
                    const data = [];
                    snap.forEach(c => { data.push(c.val()) });
                    data.reverse().forEach(item => {
                        feed.innerHTML += `
                            <div class="feed-item">
                                <span class="feed-tag">${item.bairro}</span>
                                <p>${item.texto}</p>
                                <span class="feed-meta">Publicado por ${item.autor} em ${new Date(item.timestamp).toLocaleString()}</span>
                            </div>
                        `;
                    });
                });

                // Ocorrências
                db.ref('ocorrencias').on('value', snap => {
                    const tbody = document.querySelector('#table-ocorrencias tbody');
                    const admBody = document.querySelector('#table-admin-users tbody');
                    tbody.innerHTML = '';
                    let count = 0;

                    snap.forEach(c => {
                        const o = c.val();
                        count++;
                        if(this.user && (this.user.cargo === 'ADMINISTRADOR' || this.user.nick === o.userNick)) {
                            tbody.innerHTML += `
                                <tr>
                                    <td>#${c.key.substring(1, 6)}</td>
                                    <td>${o.bairro}</td>
                                    <td>${o.tipo}</td>
                                    <td><span class="badge" style="background:#E67E22">${o.status}</span></td>
                                    <td>${new Date(o.timestamp).toLocaleDateString()}</td>
                                </tr>
                            `;
                        }
                    });
                    if(document.getElementById('adm-total-calls')) document.getElementById('adm-total-calls').innerText = count;
                });

                // Usuários (Admin)
                db.ref('users').on('value', snap => {
                    const tbody = document.querySelector('#table-admin-users tbody');
                    if(!tbody) return;
                    tbody.innerHTML = '';
                    let totalUsers = 0;
                    let totalFunc = 0;

                    snap.forEach(c => {
                        const u = c.val();
                        totalUsers++;
                        if(u.cargo === 'FUNCIONÁRIO') totalFunc++;

                        tbody.innerHTML += `
                            <tr>
                                <td>${u.nome}</td>
                                <td>${u.nick}</td>
                                <td><span class="badge badge-${u.cargo === 'ADMINISTRADOR' ? 'admin' : (u.cargo === 'FUNCIONÁRIO' ? 'func' : 'cid')}">${u.cargo}</span></td>
                                <td>
                                    <button class="btn btn-outline" style="padding:4px 8px; font-size:0.7rem" onclick="App.changeUserRole('${u.nick}', 'FUNCIONÁRIO')">FUNC</button>
                                    <button class="btn btn-outline" style="padding:4px 8px; font-size:0.7rem" onclick="App.changeUserRole('${u.nick}', 'CIDADÃO')">Cid</button>
                                </td>
                            </tr>
                        `;
                    });
                    document.getElementById('adm-total-users').innerText = totalUsers;
                    document.getElementById('adm-total-func').innerText = totalFunc;
                });
                
                // Ponto (User)
                setInterval(() => {
                    if(this.user) {
                        db.ref('ponto/' + this.user.nick).limitToLast(5).once('value', snap => {
                            const container = document.getElementById('ponto-logs');
                            if(!container) return;
                            container.innerHTML = '<h4>Últimos Registros:</h4>';
                            snap.forEach(c => {
                                container.innerHTML += `<div style="font-size:0.8rem; color:var(--text-dim)">• ${c.val().registro}</div>`;
                            });
                        });
                    }
                }, 5000);
            }
        };

        // Inicializar
        App.init();

    </script>
</body>
</html>
